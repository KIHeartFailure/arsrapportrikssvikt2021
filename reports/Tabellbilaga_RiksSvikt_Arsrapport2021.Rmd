---
title: 'Tabellbilaga: RiksSvikt Årsrapport 2021'
subtitle: DRAFT
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
    fig_caption: yes
    fig_height: 6
    fig_width: 6
    number_sections: no
urlcolor: blue
linkcolor: black
header-includes: 
  - \usepackage{draftwatermark}
  - \usepackage{subfig}
  - \usepackage[swedish]{babel}
  - \usepackage{fontspec}
  - \usepackage{fancyhdr} 
  - \pagestyle{fancy} 
  - \fancyhf{} 
  - \fancyfoot[LE, RO]{\thepage} 
  - \fancyfoot[RE, LO]{RiksSvikt Årsrapport 2021} 
  - \renewcommand{\headrulewidth}{0pt}
  - \renewcommand{\footrulewidth}{1pt}
  - \usepackage{pdflscape}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
---

\newpage 
\tableofcontents 
\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, include = TRUE, comment = "",
  warning = FALSE, message = FALSE, fig.pos = "H",
  fig.path = "../output/figs/"
)
options(knitr.kable.NA = "")
```

```{r adjust_directory_if_needed, include=FALSE}
# Uncomment lines below if rmd file is placed in a subdirectory
knitr::opts_knit$set(root.dir = normalizePath("../"))
```

```{r load_project}
# 1. Set options in config/global.dcf
# 2. Load packages listed in config/global.dcf
# 3. Import functions and code in lib directory

ProjectTemplate::reload.project()

cacheon <- TRUE
```             

# Information och förklaringar

Datauttag 2021-12-10 (prel siffror, finalt uttag görs 2022-03-01). Täckningsgrader från förra året, fås från Socialstyrelsen i april 2022 (tom 2021). 

Om inget annat anges är de redovisade siffrorna från 2021. Datum utgår från det datum som patienten skrevs in/besöksdatum.

Med index avses första gången en patient registreras i RiksSvikt, detta behöver dock inte vara en nydiagnostiserad hjärtsvikt. 

Årlig uppföljning är indelat i 1 års uppföljning (inom 1.5 år från index) och 2+ års uppföljning (efter 1.5 år från index). 

I det fall det finns mer än en årlig registrering / patient har alla poster redovisats. 
För 2+ årlig uppföljning finns XXX poster för XXX unika patienter för 2021.  

Registreringar i primärvården redovisas totalt, men inte som separata center enheter. De ingår inte heller i de regionsuppdelade redovisningarna. 

Enheter med färre än 10 registreringar i nämnaren redovisas ej.

R koden som genererat årsrapporten finns: https://github.com/KIHeartFailure/arsrapportrikssvikt2021.

\clearpage

# Täckningsgrad

**Täljare prevalent täckningsgrad:** Individer registrerade i RiksSvikt, fyllda 18 år vid tillfället, vid liv per första januari det aktuella året och registrerade i RiksSvikt någon gång under perioden från och med registrets start 2003 till och med sista december det aktuella året. För de år som uppgift om registreringsdatum finns i RiksSvikt, dvs. från och med 2017 och framåt, inkluderas bara de registreringar som inkommit fram till och med 31 mars året efter det aktuella prevalensåret.

**Nämnare prevalent täckningsgrad:** Individer fyllda 18 år och vid liv första januari det aktuella året, med någon registrering med hjärtsvikt som huvuddiagnos (I11.0, I13.0, I13.2, I25.5, I42.0, I42.6, I42.7, I50.0, I50.1, I50.9) i patientregistret fram till och med sista december det aktuella året.

**Täljare incident täckningsgrad:** Individer i RiksSvikt, fyllda 18 år och med första registrering under det aktuella året eller med första registrering inom 1 år från första hjärtsviktdiagnos i patientregistret.

**Nämnare incident täckningsgrad:** Individer som registrerats med hjärtsvikt (I11.0, I13.0, I13.2, I25.5, I42.0, I42.6, I42.7, I50.0, I50.1, I50.9) 
för första gången under det aktuella året, antingen i RiksSvikt eller i patientregistret.

*Täckningsgraden för 2021 baseras på icke kvalitetsgranskade uppgifter från Socialstyrelsen. Definitionen av täckningsgraden tillåter registreringar i RiksSvikt  tom ett år efter registrering i patientregistret så täckningsraden är därmed inte komplett för 2021. Därför bör täckningsgraden för 2021 betraktas som preliminär.* 

```{r, child = "../src/tg.Rmd"}

```

```{r, child = "../src/tg_bar.Rmd"}

```

\clearpage

# Registrering

```{r, child = "../src/regovertime.Rmd"}

```

\clearpage

# Beskrivning av patienter

```{r, child = "../src/tabs.Rmd"}

```

\blandscape

```{r, cache = cacheon, fig.cap = "Karakteristika för patienter registrerade med ett indextillfälle under 2021", fig.show='hold', out.width="25%", fig.subcap=c('Kön', 'Ålder', 'NYHA klass', 'LVEF'), fig.ncol=4}
piefunc(var = "sex")
piefunc(var = "age_cat")
piefunc(var = "FUNCTION_CLASS_NYHA")
piefunc(var = "ef_cat3")
```             

```{r, cache = cacheon, fig.cap = "Registrerande enheter 2021", fig.show='hold', out.width="25%", fig.subcap=c('Index', 'Uppföljning 6 v-6 mån', 'Uppföljning 1 år', 'Uppföljning 2+ år'), fig.ncol=4}
piefunc(var = "vtype", type = c("Index"))
piefunc(var = "vtype", type = c("Uppföljning 6 v-6 mån"))
piefunc(var = "vtype", type = c("Uppföljning 1 år"))
piefunc(var = "vtype", type = c("Uppföljning 2+ år"))
```     

\elandscape

\clearpage

# Kvalitetsindikatorer

Kvalitetsindikatorerna LVEF, NT-proBNP, NYHA klass och Hälsotillstånd rapporterat och planerad uppföljning vid hjärtsviktsmottagning är definerat vid indextillfället. Behandlingsvariabler, inklusive fysisk träning, är definerat vid uppföljningsbesöket vid 6 veckor - 6 månader efter index. 

\clearpage

```{r, child = "../src/summaryqi.Rmd"}

```

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_lvef"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** LVEF har angetts, antingen semikvantitativt eller i procent, vid indextillfället. 

**Nämnare:** Alla patienter med ett indextillfälle.

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE)
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_ntprobnp"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** NT-proBNP har angetts vid indextillfället. För slutenvårdspatienter kan detta vara 
antingen vid inskrivning eller efter 24 timmar. 
*OBS! Detta skiljer sig från UCRs definition. Där räknas INTE 24H och det kan vara antingen NT-proBNP ELLER BNP. Ändra?*

**Nämnare:** Alla patienter med ett indextillfälle.

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE, adjtext = c(0, 1))
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_nyha"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** NYHA klass I, II, III eller IV har angetts vid indextillfället. 

**Nämnare:** Alla patienter med ett indextillfälle.

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE, adjtext = c(0, -2))
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_qol"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** Total livskvalitetscore har angetts vid indextillfället.  

**Nämnare:** Alla patienter med ett indextillfälle.

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE) #, ylimmin = c(30, 70))
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_uppfhf"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** De som vid indextillfället planeras att följas upp vid en hjärtsviktsmottagning. 

**Nämnare:** Alla indextillfällen där patienten lever vid utskrivning. 

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE)
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_followreg6m"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** Patienter som har ett registrerat uppföljningsbesök 6 veckor - 6 månader efter indextillfället. 

**Nämnare:** Alla indextillfällen där patienten lever vid utskrivning. 

*Tidsintervallet för indexbesöket är 2020-07-01 - 2021-07-01.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE)
```  

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_ras"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** ACE-hämmare, A2-blockerare/ARB eller ARNI har använts. 
*OBS skillnad mot UCR, jag kräver att man ska ha värden på acei, arb, arni (annars mäter man inte om pat har ras, utan om de registrerat också i samma indikator). Samma gäller övriga behandlings indikatorer* 

**Nämnare:** Patienter där LVEF < 40% och som lever vid utskrivning och där uppgift 
om användning av ACE-hämmare, A2-blockerare/ARB och ARNI har rapporterats. 
LVEF definieras som det lägst uppmätta, antingen vid aktuellt tillfälle eller vid indextillfället. *OBS! Skillnad mot UCR, de har även avlidna i nämnaren. Ändra?. Samma gäller övriga behandlings indikatorer*

*Kvalitetsindikatorn är definierad vid uppföljningen vid 6 veckor - 6 månader efter index.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(ylimmin = c(70, 100), adjtext = c(0.15, 0, 0, -0.15))
```  

\blandscape
```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid Riket, Sjukhus och Primärvård"), fig.show='hold', out.width="33%", fig.subcap=c('Riket', 'Sjukhus', 'Primärvård'), fig.ncol=3}
barsummary(unit = c("Sjukhus", "Primärvård"))
barsummary(unit = "Sjukhus")
barsummary(unit = "Primärvård")
```             
\elandscape

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år", unit = "region")
```        

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_arni"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** ARNI har använts. 

**Nämnare:** Patienter där LVEF < 40% och som lever vid utskrivning och 
där ACE-hämmare, A2-blockerare/ARB eller ARNI har använts. 
LVEF definieras som det lägst uppmätta, antingen vid aktuellt tillfälle eller vid indextillfället. 

*Kvalitetsindikatorn är definierad vid uppföljningen vid 6 veckor - 6 månader efter index.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(adjtext = c(0, -1, 0, 0))
```  

\blandscape
```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid Riket, Sjukhus och Primärvård"), fig.show='hold', out.width="33%", fig.subcap=c('Riket', 'Sjukhus', 'Primärvård'), fig.ncol=3}
barsummary(unit = c("Sjukhus", "Primärvård"))
barsummary(unit = "Sjukhus")
barsummary(unit = "Primärvård")
```             
\elandscape

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år", unit = "region")
```        

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_bbl"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** Betablockerare har använts.

**Nämnare:** Patienter där LVEF < 40% och som lever vid utskrivning och där uppgift 
om användning av Betablockerare har rapporterats. 
LVEF definieras som det lägst uppmätta, antingen vid aktuellt tillfälle eller vid indextillfället. 

*Kvalitetsindikatorn är definierad vid uppföljningen vid 6 veckor - 6 månader efter index.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(ylimmin = c(70, 100), adjtext = c(0, 0, -0.9, -0.4))
```  

\blandscape
```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid Riket, Sjukhus och Primärvård"), fig.show='hold', out.width="33%", fig.subcap=c('Riket', 'Sjukhus', 'Primärvård'), fig.ncol=3}
barsummary(unit = c("Sjukhus", "Primärvård"))
barsummary(unit = "Sjukhus")
barsummary(unit = "Primärvård")
```             
\elandscape

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år", unit = "region")
```        

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_mra"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

*OBS!! Finns ej sedan tidigare. Jag la till*

**Täljare:** MRA har använts. 

**Nämnare:** Patienter där LVEF < 40% och som lever vid utskrivning och där uppgift 
om användning av MRA har rapporterats. 
LVEF definieras som det lägst uppmätta, antingen vid aktuellt tillfälle eller vid indextillfället. 

*Kvalitetsindikatorn är definierad vid uppföljningen vid 6 veckor - 6 månader efter index.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(adjtext = c(0, 0.2, -1.6, -1.5))
```  

\blandscape
```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid Riket, Sjukhus och Primärvård"), fig.show='hold', out.width="33%", fig.subcap=c('Riket', 'Sjukhus', 'Primärvård'), fig.ncol=3}
barsummary(unit = c("Sjukhus", "Primärvård"))
barsummary(unit = "Sjukhus")
barsummary(unit = "Primärvård")
```             
\elandscape

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år", unit = "region")
```        

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_trippel"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

*OBS!! Jag tog bort basbehandling*

**Täljare:** RAS-blockad, Betablockerare och MRA har använts. 

**Nämnare:** Patienter där LVEF < 40% och som lever vid utskrivning och där uppgift 
om användning av RAS-blockad, Betablockerare och MRA har rapporterats. 
LVEF definieras som det lägst uppmätta, antingen vid aktuellt tillfälle eller vid indextillfället. 

*Kvalitetsindikatorn är definierad vid uppföljningen vid 6 veckor - 6 månader efter index.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(adjtext = c(-1.7, 1.2, 0, 0))
```  

\blandscape
```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid Riket, Sjukhus och Primärvård"), fig.show='hold', out.width="33%", fig.subcap=c('Riket', 'Sjukhus', 'Primärvård'), fig.ncol=3}
barsummary(unit = c("Sjukhus", "Primärvård"))
barsummary(unit = "Sjukhus")
barsummary(unit = "Primärvård")
```             
\elandscape

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år", unit = "region")
```        

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_sglt2"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

*OBS!! Finns ej sedan tidigare, jag la till*

**Täljare:** SGLT-2 hämmare har använts. 

**Nämnare:** Patienter där LVEF < 40% och som lever vid utskrivning och där uppgift 
om användning av SGLT-2 hämmare har rapporterats. 
LVEF definieras som det lägst uppmätta, antingen vid aktuellt tillfälle eller vid indextillfället. 

*SGLT-2 hämmare infördes i RiksSvikt 2021-04-28 och är därför inte komplett för hela året.* 

*Kvalitetsindikatorn är definierad vid uppföljningen vid 6 veckor - 6 månader efter index.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år", unit = "region")
```        

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_crt"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** CRT (med eller utan ICD) är implanterat. 

**Nämnare:** Patienter där LVEF $<=$ 35% (LVEF i procent rapporterat) eller < 40% (semikvantitativt LVEF rapporterat) och som lever vid utskrivning och där uppgift 
om device har rapporterats. Utöver detta ska vänstergrenblock (LBBB) finnas, EKG-rytm vara sinusrytm och QRS-duration vara > 130. *Hur uttrycker man detta kliniskt???* I nämnaren ingår även personer med CRT implanterat, oavsett värden på övriga variabler. 
LVEF definieras som det lägst uppmätta, antingen vid aktuellt tillfälle eller vid indextillfället. QRS-duration och LBBB är 
i första hand det som registrerats vid aktuellt tillfälle, och i andra hand, om det saknas, det som registrerats vid indextillfället. 
*Om man saknar ekg, lbbb, qrs så kan man alltså förekomma i täljaren men inte enbart i nämnaren. Detta kommer medföra att man överskattar andelen med crt, men om man mer sällan registrerar dessa värden för device patienter så kanske det ändå är bäst (annars kommer man att underskatta andelen).*

Alt (Lars) förslag till defintion av nämnare inkl NYHA: 

crt indikation beror på QRS bredd, LBBB, sinus/FF, och NYHA
indikationer finns i olika styrkor beroende på kombination av ovan.
ESC's är striktast

1. ändra till >= 150
2. lägg till symptom, dvs NYHA II-IV
3. lägg INTE till sinusrytm krav

*Kvalitetsindikatorn är definierad vid uppföljningen vid 6 veckor - 6 månader efter index.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(adjtext = c(-.75, 0.75, 2.5, 0))
```  

\blandscape
```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid Riket, Sjukhus och Primärvård"), fig.show='hold', out.width="33%", fig.subcap=c('Riket', 'Sjukhus', 'Primärvård'), fig.ncol=3}
barsummary(unit = c("Sjukhus", "Primärvård"))
barsummary(unit = "Sjukhus")
barsummary(unit = "Primärvård")
```             
\elandscape

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år", unit = "region")
```        

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_icd"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** ICD (med eller utan CRT) är implanterat. 

**Nämnare:** Patienter där LVEF $<=$ 35% (LVEF i procent rapporterat) eller < 40% (semikvantitativt LVEF rapporterat) och som lever vid utskrivning och där uppgift 
om device har rapporterats. LVEF definieras som det lägst uppmätta, antingen vid aktuellt tillfälle eller vid indextillfället.

*Kvalitetsindikatorn är definierad vid uppföljningen vid 6 veckor - 6 månader efter index.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(adjtext = c(-0.5, 0.5, 0, 0))
```  

\blandscape
```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid Riket, Sjukhus och Primärvård"), fig.show='hold', out.width="33%", fig.subcap=c('Riket', 'Sjukhus', 'Primärvård'), fig.ncol=3}
barsummary(unit = c("Sjukhus", "Primärvård"))
barsummary(unit = "Sjukhus")
barsummary(unit = "Primärvård")
```             
\elandscape

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år", unit = "region")
```        

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_fys"
lltmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ll)
ultmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(ul)
qinametmp <- qiinfo %>% filter(qivar == qitmp) %>% pull(qiname)
```             

## Kvalitetsindikator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", qinametmp)` 

**Täljare:** Deltagande i organiserad fysisk träning har skett. 

**Nämnare:** Patienter som lever vid utskrivning och där uppgift 
om deltagande i organiserad fysisk träning har rapporterats. 

*Kvalitetsindikatorn är definierad vid uppföljningen vid 6 veckor - 6 månader efter index.*

```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid"), fig.width=9, fig.height=7}
timefunc(adjtext = c(0, 0.7, -0.9, 0))
```  

\blandscape
```{r, cache = cacheon, fig.cap = paste(qinametmp, " över tid Riket, Sjukhus och Primärvård"), fig.show='hold', out.width="33%", fig.subcap=c('Riket', 'Sjukhus', 'Primärvård'), fig.ncol=3}
barsummary(unit = c("Sjukhus", "Primärvård"))
barsummary(unit = "Sjukhus")
barsummary(unit = "Primärvård")
```             
\elandscape

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år", unit = "region")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på region"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år", unit = "region")
```        

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid Index uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 6 veckors - 6 månaders uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 6 v-6 mån")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 1 års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 1 år")
```             

```{r, cache = cacheon, fig.cap = paste(qinametmp, " vid 2+ års uppföljningen uppdelat på sjukhus"), fig.width=7, fig.height=8}
qifunc(type = "Uppföljning 2+ år")
```    